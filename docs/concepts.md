# Концепции и архитектура

## Skill

Навык описывается YAML-метаданными и Python-реализацией. В метаданных задаются:

- идентификатор (`domain/name`)
- входные/выходные типы
- разрешения и роль
- entrypoint (Python-функция)

Реализация находится в `skills/implementations/...`.

## Orchestrator

Оркестратор выбирает навык по запросу, учитывая:

- режим маршрутизации (keyword/vector/hybrid)
- политики доступа
- approval политики
- бюджетные лимиты

## Composition и Pipeline

- **Composition** — цепочка шагов.
- **Pipeline** — исполняет набор шагов, в том числе параллельные группы.

Параллельная группа задается через `skillA|skillB`.

## Политики доступа и утверждений

- **Permission policies** — соответствие навыка и требуемых прав для ролей.
- **Approval policies** — шаги, требующие ручного подтверждения.

Файлы лежат в `skills/policies/`.

## Бюджеты

Контролируют стоимость запросов и выбор модели. Лимиты настраиваются через env.

## Circuit breaker

Защищает от повторяющихся ошибок, открывая "цепь" после серии фейлов.
Состояние хранится в `runtime/circuit_breaker.json`.

## Jobs

Асинхронные задания с retry и возможностью DLQ-реактивации.

## Schedules

Периодические задания с расписанием (cron-like).

## Tenancy

Поддерживается изоляция по tenant в путях и storage.

## Idempotency

Защищает от дублирующихся событий (например, вебхуки).

## Rate limiting

Два режима:

- best-effort без Redis
- strict (Redis + Lua) для multi-instance

## Health checks

`GET /health` возвращает состояние диска, базы и кэша.
